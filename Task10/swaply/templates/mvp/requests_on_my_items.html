{% extends "base.html" %}

{% block title %}Requests on My Items | Swaply{% endblock %}

{% block content %}
  <div class="d-flex align-items-center justify-content-between gap-3 mb-4">
    <h1 class="h4 mb-0">Requests on My Items</h1>
  </div>

  <div class="card-soft p-4 p-md-5">
    <div class="d-flex align-items-center justify-content-between gap-3 mb-3">
      <h2 class="h5 mb-0">Pending</h2>
      <span class="small muted">Accept / Reject</span>
    </div>

    {% if incoming_requests %}
      <div class="table-responsive">
        <table class="table align-middle mb-0">
          <thead>
            <tr>
              <th>Item name</th>
              <th>Requester</th>
              <th>Status</th>
              <th class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for req in incoming_requests %}
              <tr>
                <td class="fw-semibold">{{ req.item.title }}</td>
                <td>{{ req.requester.username|default:req.requester.email }}</td>
                <td><span class="badge text-bg-warning">Pending</span></td>
                <td class="text-end">
                  <div class="d-inline-flex gap-2">
                    <form method="post" action="{% url 'mvp:request_accept' req.id %}">
                      {% csrf_token %}
                      <input type="hidden" name="next" value="{{ request.get_full_path }}" />
                      <button class="btn btn-sm btn-success" type="submit">Accept</button>
                    </form>
                    <form method="post" action="{% url 'mvp:request_reject' req.id %}">
                      {% csrf_token %}
                      <input type="hidden" name="next" value="{{ request.get_full_path }}" />
                      <button class="btn btn-sm btn-outline-danger" type="submit">Reject</button>
                    </form>
                  </div>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="muted">No pending requests yet.</div>
    {% endif %}
  </div>

  <div class="card-soft p-4 p-md-5 mt-4">
    <div class="d-flex align-items-center justify-content-between gap-3 mb-3">
      <h2 class="h5 mb-0">Completed Transactions</h2>
      <span class="small muted">Accepted / Rejected</span>
    </div>

    {% if completed_transactions %}
      <div class="table-responsive">
        <table class="table align-middle mb-0">
          <thead>
            <tr>
              <th>Item name</th>
              <th>Requester</th>
              <th>Status</th>
              <th class="text-end">Date</th>
            </tr>
          </thead>
          <tbody>
            {% for req in completed_transactions %}
              <tr>
                <td class="fw-semibold">{{ req.item.title }}</td>
                <td>{{ req.requester.username|default:req.requester.email }}</td>
                <td>
                  {% if req.status == 'accepted' %}
                    <span class="badge text-bg-success">Accepted</span>
                  {% elif req.status == 'rejected' %}
                    <span class="badge text-bg-danger">Rejected</span>
                  {% else %}
                    <span class="badge text-bg-secondary">{{ req.status|title }}</span>
                  {% endif %}
                </td>
                <td class="text-end small muted">{{ req.created_at|date:"M d, Y" }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="muted">No completed transactions yet.</div>
    {% endif %}
  </div>
{% endblock %}
